{"version":3,"file":"fast-nav.js","sources":["../../assets/js/modules/dom.js","../../assets/js/modules/events.js","../../assets/js/fast-nav.js"],"sourcesContent":["export function ready(cb) {\n  if (\n    document.readyState === 'interactive' ||\n    document.readyState === 'complete'\n  ) {\n    cb();\n  } else {\n    document.addEventListener(\n      'DOMContentLoaded',\n      () => {\n        cb();\n      },\n      {\n        capture: true,\n        once: true,\n        passive: true,\n      },\n    );\n  }\n}\n\nexport function htmlToNodes(html, single = false) {\n  const template = document.createElement('template');\n  template.innerHTML = html.trim();\n  return single ? template.content.childNodes[0] : template.content.childNodes;\n}\n\nexport function nodesToHtml(nodes) {\n  return (nodes instanceof NodeList ? Array.from(nodes) : [nodes]).reduce(\n    (html, node) => `${html}${node.outerHTML}`,\n    '',\n  );\n}\n","/**\n * DOM event handling.\n *\n * Listeners receive a custom event object inspired by jQuery that has the\n * .target prop set to the event target when using delegation. It may also\n * normalize some other things.\n *\n * Additionally, a second parameter with extra data may be present if listening\n * to a custom event that has it set (would be the same data as the event's\n * `detail` property).\n */\n\nexport const NAV_EVENT = 'jpnotes-nav';\n\nclass JPNotesEvent {\n  constructor(srcEvent, target = null) {\n    this.originalEvent = srcEvent;\n\n    // Targets\n    // Custom target if passed\n    this.target =\n      target ||\n      // Target should not be a text node\n      (srcEvent.target && srcEvent.target.nodeType === 3\n        ? srcEvent.target.parentNode\n        : srcEvent.target);\n    this.currentTarget = srcEvent.currentTarget;\n    this.relatedTarget = srcEvent.relatedTarget;\n\n    // Meta data\n    // Create a timestamp if incoming event doesn't have one\n    this.timeStamp = (srcEvent && srcEvent.timeStamp) || Date.now();\n\n    const copyProps = [\n      'altKey',\n      'bubbles',\n      'button',\n      'buttons',\n      'cancelable',\n      'changedTouches',\n      'char',\n      'charCode',\n      'clientX',\n      'clientY',\n      'code',\n      'ctrlKey',\n      'detail',\n      'eventPhase',\n      'key',\n      'keyCode',\n      'metaKey',\n      'offsetX',\n      'offsetY',\n      'pageX',\n      'pageY',\n      'pointerId',\n      'pointerType',\n      'screenX',\n      'screenY',\n      'shiftKey',\n      'srcElement',\n      'targetTouches',\n      'toElement',\n      'touches',\n      'type',\n      'view',\n    ];\n    copyProps.forEach((propName) => {\n      this[propName] = srcEvent[propName];\n    });\n  }\n\n  preventDefault() {\n    this.originalEvent.preventDefault();\n  }\n\n  stopPropagation() {\n    this.originalEvent.stopPropagation();\n  }\n\n  stopImmediatePropagation() {\n    this.originalEvent.stopImmediatePropagation();\n  }\n}\n\nexport function on(el, eventName, delegate, listener) {\n  if (typeof delegate === 'function') {\n    el.addEventListener(\n      eventName,\n      (event) => {\n        delegate(\n          new JPNotesEvent(event),\n          event instanceof CustomEvent ? event.detail : undefined,\n        );\n      },\n      false,\n    );\n  } else {\n    el.addEventListener(\n      eventName,\n      (event) => {\n        let { target } = event;\n        while (target) {\n          if (target.matches(delegate)) {\n            listener(\n              new JPNotesEvent(event, target),\n              event instanceof CustomEvent ? event.detail : undefined,\n            );\n            return;\n          }\n          target =\n            target !== event.currentTarget && target !== document.body\n              ? target.parentNode\n              : null;\n        }\n      },\n      false,\n    );\n  }\n\n  return el;\n}\n\nexport function off(el, eventName, listener) {\n  el.removeEventListener(eventName, listener);\n}\n\nexport function triggerCustomEvent(eventName, extraData, target = document) {\n  target.dispatchEvent(new CustomEvent(eventName, { detail: extraData }));\n}\n\nexport function onCustomEvent(eventName, callback, target = document) {\n  on(target, eventName, callback);\n}\n","import { ready } from './modules/dom';\nimport { NAV_EVENT, on, triggerCustomEvent } from './modules/events';\n\nconst NAV_SELECTOR = '.sidebar-nav';\nconst CONTENT_SELECTOR = '.main-body';\nconst NAV_ACTIVE_CLASS = 'active';\nconst NAV_ACTIVE_SELECTOR = `.${NAV_ACTIVE_CLASS}`;\n\n/**\n * Ajax navigation for the main menu.\n *\n * Like Turbolinks, but much smaller since it can be tailored for this site.\n * When clicking a main navigation link, the target page is fetched and the\n * response parsed. The main body content is updated and the active nav item\n * class is set.\n *\n * Doing this not only results in faster loading pages (even more so for repeat\n * visits to the same page, since it's only fetched once), but it also prevents\n * FOUT on all but the first page load. This is otherwise unavoidable since\n * both the Typekit script and the fonts it loads are async.\n */\nclass FastNav {\n  constructor() {\n    this.cache = {};\n    this.nav = document.querySelector(NAV_SELECTOR);\n    this.content = document.querySelector(CONTENT_SELECTOR);\n    this.parser = new DOMParser();\n\n    // State for the initial page load\n    this.pageLoadState = this.getPageState(\n      document.title,\n      this.nav.querySelector(NAV_ACTIVE_SELECTOR).id,\n      this.content.innerHTML,\n    );\n\n    this.bindListeners();\n  }\n\n  getPageState(title, activeNavId, contentHTML) {\n    return { title, activeNavId, contentHTML };\n  }\n\n  bindListeners() {\n    on(this.nav, 'click', 'a', this.handleNavClick);\n    window.onpopstate = this.handleHistoryPopState;\n  }\n\n  parsePageToState(newPageHTML) {\n    const newPage = this.parser.parseFromString(newPageHTML, 'text/html');\n    const activeNavItem = newPage\n      .querySelector(NAV_SELECTOR)\n      .querySelector(NAV_ACTIVE_SELECTOR);\n    const newContent = newPage.querySelector(CONTENT_SELECTOR);\n\n    return this.getPageState(\n      newPage.title,\n      activeNavItem.id,\n      newContent.innerHTML,\n    );\n  }\n\n  updatePage(pageState) {\n    // Set page title\n    document.title = pageState.title;\n\n    // Set active nav class\n    this.nav\n      .querySelector(NAV_ACTIVE_SELECTOR)\n      .classList.remove(NAV_ACTIVE_CLASS);\n    document\n      .getElementById(pageState.activeNavId)\n      .classList.add(NAV_ACTIVE_CLASS);\n\n    // Replace the content body\n    this.content.innerHTML = pageState.contentHTML;\n  }\n\n  addHistory(url, state = {}) {\n    window.history.pushState(state, state.title || '', url);\n  }\n\n  navigateToPage(url, pageState) {\n    this.updatePage(pageState);\n    this.addHistory(url, pageState);\n    window.scrollTo(0, 0);\n    triggerCustomEvent(NAV_EVENT);\n  }\n\n  handleNavClick = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const newUrl = e.target.href;\n\n    if (this.cache[newUrl]) {\n      this.navigateToPage(newUrl, this.cache[newUrl]);\n      return;\n    }\n\n    fetch(newUrl)\n      .then((response) => response.text())\n      .then((html) => {\n        const newPageState = this.parsePageToState(html);\n        this.cache[newUrl] = newPageState;\n        this.navigateToPage(newUrl, newPageState);\n      })\n      .catch(() => {\n        // Navigate normally in case of errors\n        window.location = newUrl;\n      });\n  };\n\n  handleHistoryPopState = (e) => {\n    const pageState =\n      e.state && Object.keys(e.state).length ? e.state : this.pageLoadState;\n    this.updatePage(pageState);\n  };\n}\n\nready(() => {\n  window.FAST_NAV = new FastNav();\n});\n"],"names":["ready","cb","document","readyState","addEventListener","capture","once","passive","NAV_EVENT","JPNotesEvent","constructor","srcEvent","target","originalEvent","nodeType","parentNode","currentTarget","relatedTarget","timeStamp","Date","now","copyProps","forEach","propName","preventDefault","stopPropagation","stopImmediatePropagation","on","el","eventName","delegate","listener","event","CustomEvent","detail","undefined","matches","body","triggerCustomEvent","extraData","dispatchEvent","NAV_SELECTOR","CONTENT_SELECTOR","NAV_ACTIVE_CLASS","NAV_ACTIVE_SELECTOR","FastNav","handleNavClick","e","newUrl","href","cache","navigateToPage","fetch","then","response","text","html","newPageState","parsePageToState","catch","window","location","handleHistoryPopState","pageState","state","Object","keys","length","pageLoadState","updatePage","nav","querySelector","content","parser","DOMParser","getPageState","title","id","innerHTML","bindListeners","activeNavId","contentHTML","onpopstate","newPageHTML","newPage","parseFromString","activeNavItem","newContent","classList","remove","getElementById","add","addHistory","url","history","pushState","scrollTo","FAST_NAV"],"mappings":"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"}