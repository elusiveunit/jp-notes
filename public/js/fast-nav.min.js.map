{"version":3,"file":"fast-nav.min.js","sources":["../../assets/js/modules/dom.js","../../assets/js/modules/events.js","../../assets/js/fast-nav.js"],"sourcesContent":["export function ready(cb) {\n  if (\n    document.readyState === 'interactive' ||\n    document.readyState === 'complete'\n  ) {\n    cb();\n  } else {\n    document.addEventListener(\n      'DOMContentLoaded',\n      () => {\n        cb();\n      },\n      {\n        capture: true,\n        once: true,\n        passive: true,\n      },\n    );\n  }\n}\n\nexport function htmlToNodes(html, single = false) {\n  const template = document.createElement('template');\n  template.innerHTML = html.trim();\n  return single ? template.content.childNodes[0] : template.content.childNodes;\n}\n\nexport function nodesToHtml(nodes) {\n  return (nodes instanceof NodeList ? Array.from(nodes) : [nodes]).reduce(\n    (html, node) => `${html}${node.outerHTML}`,\n    '',\n  );\n}\n","/**\n * DOM event handling.\n *\n * Listeners receive a custom event object inspired by jQuery that has the\n * .target prop set to the event target when using delegation. It may also\n * normalize some other things.\n *\n * Additionally, a second parameter with extra data may be present if listening\n * to a custom event that has it set (would be the same data as the event's\n * `detail` property).\n */\n\nexport const NAV_EVENT = 'jpnotes-nav';\n\nclass JPNotesEvent {\n  constructor(srcEvent, target = null) {\n    this.originalEvent = srcEvent;\n\n    // Targets\n    // Custom target if passed\n    this.target =\n      target ||\n      // Target should not be a text node\n      (srcEvent.target && srcEvent.target.nodeType === 3\n        ? srcEvent.target.parentNode\n        : srcEvent.target);\n    this.currentTarget = srcEvent.currentTarget;\n    this.relatedTarget = srcEvent.relatedTarget;\n\n    // Meta data\n    // Create a timestamp if incoming event doesn't have one\n    this.timeStamp = (srcEvent && srcEvent.timeStamp) || Date.now();\n\n    const copyProps = [\n      'altKey',\n      'bubbles',\n      'button',\n      'buttons',\n      'cancelable',\n      'changedTouches',\n      'char',\n      'charCode',\n      'clientX',\n      'clientY',\n      'code',\n      'ctrlKey',\n      'detail',\n      'eventPhase',\n      'key',\n      'keyCode',\n      'metaKey',\n      'offsetX',\n      'offsetY',\n      'pageX',\n      'pageY',\n      'pointerId',\n      'pointerType',\n      'screenX',\n      'screenY',\n      'shiftKey',\n      'srcElement',\n      'targetTouches',\n      'toElement',\n      'touches',\n      'type',\n      'view',\n    ];\n    copyProps.forEach((propName) => {\n      this[propName] = srcEvent[propName];\n    });\n  }\n\n  preventDefault() {\n    this.originalEvent.preventDefault();\n  }\n\n  stopPropagation() {\n    this.originalEvent.stopPropagation();\n  }\n\n  stopImmediatePropagation() {\n    this.originalEvent.stopImmediatePropagation();\n  }\n}\n\nexport function on(el, eventName, delegate, listener) {\n  if (typeof delegate === 'function') {\n    el.addEventListener(\n      eventName,\n      (event) => {\n        delegate(\n          new JPNotesEvent(event),\n          event instanceof CustomEvent ? event.detail : undefined,\n        );\n      },\n      false,\n    );\n  } else {\n    el.addEventListener(\n      eventName,\n      (event) => {\n        let { target } = event;\n        while (target) {\n          if (target.matches(delegate)) {\n            listener(\n              new JPNotesEvent(event, target),\n              event instanceof CustomEvent ? event.detail : undefined,\n            );\n            return;\n          }\n          target =\n            target !== event.currentTarget && target !== document.body\n              ? target.parentNode\n              : null;\n        }\n      },\n      false,\n    );\n  }\n\n  return el;\n}\n\nexport function off(el, eventName, listener) {\n  el.removeEventListener(eventName, listener);\n}\n\nexport function triggerCustomEvent(eventName, extraData, target = document) {\n  target.dispatchEvent(new CustomEvent(eventName, { detail: extraData }));\n}\n\nexport function onCustomEvent(eventName, callback, target = document) {\n  on(target, eventName, callback);\n}\n","import { ready } from './modules/dom';\nimport { NAV_EVENT, on, triggerCustomEvent } from './modules/events';\n\nconst NAV_SELECTOR = '.sidebar-nav';\nconst CONTENT_SELECTOR = '.main-body';\nconst NAV_ACTIVE_CLASS = 'active';\nconst NAV_ACTIVE_SELECTOR = `.${NAV_ACTIVE_CLASS}`;\n\n/**\n * Ajax navigation for the main menu.\n *\n * Like Turbolinks, but much smaller since it can be tailored for this site.\n * When clicking a main navigation link, the target page is fetched and the\n * response parsed. The main body content is updated and the active nav item\n * class is set.\n *\n * Doing this not only results in faster loading pages (even more so for repeat\n * visits to the same page, since it's only fetched once), but it also prevents\n * FOUT on all but the first page load. This is otherwise unavoidable since\n * both the Typekit script and the fonts it loads are async.\n */\nclass FastNav {\n  constructor() {\n    this.cache = {};\n    this.nav = document.querySelector(NAV_SELECTOR);\n    this.content = document.querySelector(CONTENT_SELECTOR);\n    this.parser = new DOMParser();\n\n    // State for the initial page load\n    this.pageLoadState = this.getPageState(\n      document.title,\n      this.nav.querySelector(NAV_ACTIVE_SELECTOR).id,\n      this.content.innerHTML,\n    );\n\n    this.bindListeners();\n  }\n\n  getPageState(title, activeNavId, contentHTML) {\n    return { title, activeNavId, contentHTML };\n  }\n\n  bindListeners() {\n    on(this.nav, 'click', 'a', this.handleNavClick);\n    window.onpopstate = this.handleHistoryPopState;\n  }\n\n  parsePageToState(newPageHTML) {\n    const newPage = this.parser.parseFromString(newPageHTML, 'text/html');\n    const activeNavItem = newPage\n      .querySelector(NAV_SELECTOR)\n      .querySelector(NAV_ACTIVE_SELECTOR);\n    const newContent = newPage.querySelector(CONTENT_SELECTOR);\n\n    return this.getPageState(\n      newPage.title,\n      activeNavItem.id,\n      newContent.innerHTML,\n    );\n  }\n\n  updatePage(pageState) {\n    // Set page title\n    document.title = pageState.title;\n\n    // Set active nav class\n    this.nav\n      .querySelector(NAV_ACTIVE_SELECTOR)\n      .classList.remove(NAV_ACTIVE_CLASS);\n    document\n      .getElementById(pageState.activeNavId)\n      .classList.add(NAV_ACTIVE_CLASS);\n\n    // Replace the content body\n    this.content.innerHTML = pageState.contentHTML;\n  }\n\n  addHistory(url, state = {}) {\n    window.history.pushState(state, state.title || '', url);\n  }\n\n  navigateToPage(url, pageState) {\n    this.updatePage(pageState);\n    this.addHistory(url, pageState);\n    window.scrollTo(0, 0);\n    triggerCustomEvent(NAV_EVENT);\n  }\n\n  handleNavClick = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const newUrl = e.target.href;\n\n    if (this.cache[newUrl]) {\n      this.navigateToPage(newUrl, this.cache[newUrl]);\n      return;\n    }\n\n    fetch(newUrl)\n      .then((response) => response.text())\n      .then((html) => {\n        const newPageState = this.parsePageToState(html);\n        this.cache[newUrl] = newPageState;\n        this.navigateToPage(newUrl, newPageState);\n      })\n      .catch(() => {\n        // Navigate normally in case of errors\n        window.location = newUrl;\n      });\n  };\n\n  handleHistoryPopState = (e) => {\n    const pageState =\n      e.state && Object.keys(e.state).length ? e.state : this.pageLoadState;\n    this.updatePage(pageState);\n  };\n}\n\nready(() => {\n  window.FAST_NAV = new FastNav();\n});\n"],"names":["ready","cb","document","readyState","addEventListener","capture","once","passive","NAV_EVENT","JPNotesEvent","constructor","srcEvent","target","originalEvent","nodeType","parentNode","currentTarget","relatedTarget","timeStamp","Date","now","forEach","propName","preventDefault","stopPropagation","stopImmediatePropagation","on","el","eventName","delegate","listener","event","CustomEvent","detail","matches","body","triggerCustomEvent","extraData","dispatchEvent","NAV_SELECTOR","CONTENT_SELECTOR","NAV_ACTIVE_CLASS","NAV_ACTIVE_SELECTOR","FastNav","handleNavClick","e","newUrl","href","cache","navigateToPage","fetch","then","response","text","html","newPageState","parsePageToState","catch","window","location","handleHistoryPopState","pageState","state","Object","keys","length","pageLoadState","updatePage","nav","querySelector","content","parser","DOMParser","getPageState","title","id","innerHTML","bindListeners","activeNavId","contentHTML","onpopstate","newPageHTML","newPage","parseFromString","activeNavItem","newContent","classList","remove","getElementById","add","addHistory","url","history","pushState","scrollTo","FAST_NAV"],"mappings":"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"}